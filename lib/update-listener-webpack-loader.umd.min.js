(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["update-listener-webpack-loader"]=t(require("vue")):e["update-listener-webpack-loader"]=t(e["Vue"])})("undefined"!==typeof self?self:this,(function(e){return function(){"use strict";var t={203:function(t){t.exports=e}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}!function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p=""}();var i={};return function(){if(o.r(i),o.d(i,{default:function(){return y}}),"undefined"!==typeof window){var e=window.document.currentScript,t=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);t&&(o.p=t[1])}var n=o(203),r=o.n(n);function s(e,t,n){return(o,i=!0)=>new Promise(((s,c)=>{const a=r().extend(e),d=Object.assign({},t,o),l=new a({el:document.createElement("div"),propsData:d});l.$on("cancel",(function(e){this.$destroy();const t=this.$el.parentElement;t&&t.removeChild(this.$el),c(e)})),l.$on("confirm",(function(e){if(i){this.$destroy();const e=this.$el.parentElement;e&&e.removeChild(this.$el)}s(e,this)})),n||(n=document.body),n.appendChild(l.$el)}))}var c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"update-confirm"},[t("div",{staticClass:"update-confirm__wrapper"},[t("div",{staticClass:"update-confirm__header"},[t("div",{staticClass:"update-confirm__title"},[e._v("提示")]),t("div",{staticClass:"update-confirm__close",on:{click:e.cancel}},[e._v(" × ")])]),t("div",{staticClass:"update-confirm__content"},[t("div",{staticClass:"update-confirm__desc"},[e._v(e._s(e.content))])]),t("div",{staticClass:"update-confirm__btns"},[t("div",{staticClass:"update-confirm__btn update-confirm__btn--default",on:{click:e.cancel}},[e._v("取消")]),t("div",{staticClass:"update-confirm__btn update-confirm__btn--primary",on:{click:e.confirm}},[e._v("确定")])])])])},a=[],d={name:"UpdateConfirm",props:{content:{type:String,default:""}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},l=d;function u(e,t,n,o,i,r,s,c){var a,d="function"===typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=n,d._compiled=!0),o&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),s?(a=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=a):i&&(a=c?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),a)if(d.functional){d._injectStyles=a;var l=d.render;d.render=function(e,t){return a.call(t),l(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,a):[a]}return{exports:e,options:d}}var f=u(l,c,a,!1,null,"95a33740",null),p=f.exports;async function v(e,t){return s(p,e,t)()}const m={install(e,t){let n,o;const i=async()=>fetch(`${t.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((e=>e.json())).catch((e=>{console.log(e)})),r=async()=>{const e=(await i()).commitHash;return e!==n},s=()=>{o&&(console.log("停止检查更新"),clearInterval(o),o="",document.removeEventListener("visibilitychange",d),window.removeEventListener("error",l))},c=async()=>{if(!t.isTip)return;const e=await i();if(!e)return;n=e.commitHash;const c=/--no-tip/;c.test(e.message)||(console.log("开始检查更新"),o=setInterval((async()=>{const e=await r();e&&(console.log("有新版本"),s(),await a())}),t.interval||3e5))},a=async()=>{try{await v({content:"发现新版本，是否立即更新？"}),window.location.reload()}catch(e){console.log(e)}},d=()=>{document.hidden?s():c()};document.addEventListener("visibilitychange",d);const l=async e=>{"SCRIPT"===e.target.nodeName&&(s(),await a())};t.isListenJSError?window.addEventListener("error",l):window.removeEventListener("error",l),c()}};var _=m,h=_,y=h}(),i}()}));
//# sourceMappingURL=update-listener-webpack-loader.umd.min.js.map